\subsection{Square root (Not yet supported)}
\label{subsec:sqrt}

In Figure~\ref{fig:sqrt-generic}, we describe the replicated protocol for computing
the square root function on secret fixedpoints. The general idea is similar to
Liedel's algorithm (\cite{Liedel2012SecureDC}), however it uses a different method
for the initial approximation of $f$. Whereas Liedel normalizes the input $x$ to
$[\frac{1}{2}, 1]$ and computes a linear approximation to $g(x) = 1 / \sqrt{x}$ on
this interval (eventually multiplied by $x$ to produce $\sqrt{x}$), the approach in
\cite{cryptoeprint:2019:354} simply finds the power of 2 nearest to the fixedpoint
encoding of $f(x)$. Their key insight is that this cruder approximation is enough
to condition the Newton-Raphson/Goldschmidt optimization.

\begin{Boxfig}{Simplified normalize for square root.}{fig:simp-norm-sq}
  {$\mathsf{SimpNormSq}_{[P_1, P_2, P_3]}(\share{\vb}^\mathsf{rep}_{2^k}, k)$}
  Somewhat similar to Norm in Figure~\ref{fig:norm}, but assumes $\vb \geq 0$.
  Returns a secret $\share{\vw} = \share{2^{\vm/2}}$ for some $\vm$ such that
  $2^{\vm-1} \leq \share{\vb} < 2^\vm$.
  \begin{enumerate}
    \item Hi
  \end{enumerate}
\end{Boxfig}

\begin{Boxfig}{Generic fixed point square root protocol.}{fig:sqrt-generic}
  {$\mathsf{Sqrt}_{[P_1, P_2, P_3]}(\share{\vx}^\mathsf{rep}_{2^k}, k, f)$}
  \begin{enumerate}
    \item $\theta = \max(\log_2(k), 6)$
    \item $\share{\vm_{odd}}, \share{\vw} = \mathsf{SimpNormSq}(\share{\vx})$
    \item $f_{odd} = f \bmod 2$
    % m_odd = choose(f mod2, 1 - m_odd, m_odd)
    % if fractional precision is odd, bitswap m_odd. o.w. do nothing
    \item $\share{\vm_{odd}} = (1 - 2 \share{\vm_{odd}}) \cdot f_{odd} + \vm_{odd}$
    % w = choose((1 - m_odd)(f mod2), 2w, w)
    % if parity of msb is even and fractional precision is odd, bump power of approx by 1. o.w. do nothing
    \item $\share{\vw} = (2 \share{\vw} - \share{\vw}) \cdot (1 - \share{\vm_{odd}}) \cdot f_{odd} + \share{\vw}$
    \item $t = (f - f_{odd}) / 2$
    \item $\share{\vw'} = \mathsf{Encode}(\share{\vw} \cdot 2^t, k-f, f)$
    % w' = choose(m_odd, w' * \sqrt{2}, w')
    % if parity of msb is odd, bump power of w' by 1/2. o.w. do nothing
    \item $\share{\vw'} = (\sqrt{2} \share{\vw'} - \share{\vw'}) \cdot \share{\vm_{odd}} + \share{\vw'}$
    \item $\share{\vy} = \share{\vw'}^{-1}$
    \item $\share{\vg} = \share{\vx} \cdot \share{\vy}$
    \item $\share{\vh} = \share{\vy} / 2$
    \item For $i \in [1, \theta]$:
    \begin{enumerate}
      \item $\share{\vr} = \frac{3}{2} - \share{\vg} \cdot \share{\vh}$
      \item $\share{\vg} = \share{\vg} \cdot \share{\vr}$
      \item $\share{\vh} = \share{\vh} \cdot \share{\vr}$
    \end{enumerate}
    \item $\share{\vr} = \frac{3}{2} - \share{\vg} \cdot \share{\vh}$
    \item $\share{\vh} = \share{\vh} \cdot \share{\vr}$
    \item $\share{\vH} = \share{\vh} \cdot (3 - 4 \cdot \share{\vx} \cdot \share{\vh}^2)$
    \item $\share{\sqrt{\vx}} = \share{\vx} \cdot \share{\vH}$
  \end{enumerate}
\end{Boxfig}