\subsection{Division}
\label{subsec:division}


\begin{Boxfig}{Generic fixed point division protocol.}{fig:division-generic}
  {$\mathsf{3PCDiv}_{[P_1, P_2, P_3]}(R; \share{\va}^\mathsf{rep}_{2^k}, \share{\vb}^\mathsf{rep}_{2^k})$}
  \begin{enumerate}
    \item Let $\va, \vb \in \verb|fixed(k, f)|$ be fixed point encoded tensors.
    \item Compute $\theta = \log_2({k/3.5})$.
    \item Denote $r_f = f$.
    \item Set $\alpha = 2^{2\cdot f}$. Note that $\alpha = 1 \in \Q_{\langle k, 2\cdot f \rangle}$ representation.
    \item $\share{\vw} = \mathsf{AppRcr}(\share{\vb}, k, f, \kappa)$.
    \item $\share{\vx} = \valpha - \share{\vb} \cdot w$.
    \item $\share{\vy} = \share{\va} \cdot \share{\vw}$.
    \item $\share{\vy} = \mathsf{Round}(\share{\vy}, 2\cdot k, f)$.
    \item For $i \in [0, \theta - 1]$:
  \begin{enumerate}
    \item $\share{\vy} = \share{\vy} \cdot (\valpha + \share{\vx})$.
    \item $\share{\vx} = \share{\vx} \cdot \share{\vx}$.
    \item $\share{\vy} = \mathsf{Round}(\share{\vy}, 2 \cdot k, 2 \cdot f)$.
    \item $\share{\vx} = \mathsf{Round}(\share{\vx}, 2\cdot k, 2\cdot f)$.
  \end{enumerate}
  \item $\share{\vy} = \share{\vy} \cdot (\valpha + \share{\vx})$.
  \item $\share{\vy} = \mathsf{Round}(k + 3 \cdot f - r_f, 3 \cdot f - r_f)$.
  \item Return $\share{\vy}$.
\end{enumerate}
\end{Boxfig}

\begin{Boxfig}{Approximate reciprocical.}{fig:appRcr}
  {$\mathsf{AppRcr}_{[P_1, P_2, P_3]}(R; \share{\vb}^\mathsf{rep}_{2^k}, k, f)$}
  \begin{enumerate}
    \item Compute $\alpha = 2.9142 \cdot 2^k$. Here $\alpha = 2.9142 \in \Q_{\langle k + f, k\rangle}$.
    \item $\share{\vc}, \share{\vv} = \mathsf{Norm}(\share{\vb}, k, f)$.
    \item $\share{\vd} = \valpha - 2 \cdot \share{\vc}$.
    \item $\share{\vw} = \share{\vd} \cdot \share{\vv}$.
    \item $\share{\vw} = \mathsf{Round}(\share{\vw}, 2 \cdot k, 2 \cdot (k - f))$.
  \item Return $\share{\vw}$.
\end{enumerate}
\end{Boxfig}


\begin{Boxfig}{Normalize algorithm.}{fig:norm}
  {$\mathsf{Norm}_{[P_1, P_2, P_3]}(R; \share{\vb}^\mathsf{rep}_{2^k}, k, f)$}
  \begin{enumerate}
    \item $\share{\mathsf{sgn}} = 1 - 2 \cdot \mathsf{LTZ}(\share{\vb})$.
    \item $\share{\vx} = \share{\mathsf{sgn}} \cdot \share{\vb}$.
    \item $\share{\vx_0}, \dots, \share{\vx_{k-1}} = \mathsf{BitDec}(\vx, k)$.
    \item $\share{\vy_0}, \dots, \share{\vy_{k-1}} = \mathsf{PreOR}(\share{\vx_{k-1}}, \dots, \share{\vx_0})$.
    \item For $i \in [0, k-2]$:
    \begin{enumerate}
        \item $\share{\vz_i} = \share{\vy_i} - \share{\vy_{i+1}}$
    \end{enumerate}
    \item $\share{z_{k-1}} = \share{\vy_{k-1}}$.
    \item $\share{\vs} \asn \sum_{i=0}^{k-1}2^{k-i-1} \cdot \share{\vz_i}$.
    \item $\share{\vc} = \share{\vx} \cdot \share{\vs}$.
    \item $\share{\vv} = \share{\mathsf{sgn}} \cdot \share{\vs}$.
\end{enumerate}
\end{Boxfig}



\begin{Boxfig}{Ring Bit Decomposition.}{fig:ring-bit-dec}
  {$\mathsf{BitDec}_{[P_1, P_2, P_3]}(R; \share{\vx}^\mathsf{rep}_{2^k}, k)$}
  \begin{enumerate}
  \item $(\share{\vb_0}_2, \dots, \share{\vb_{k-1}}_2) \asn \mathsf{BitDecRaw}(\vx^\mathsf{rep}_{2^k})$.
  \item Denote $\overline{\share{\vb}_2} = [\share{\vb_0}_2, \dots, \share{\vb_{k-1}}_2]$ as the tensor containing $\Z_2$ shares of $\vx$'s bits.
  \item Call $\overline{\share{\vc}} = \mathsf{B2A}(\overline{\share{\vb}_2})$ where $\share{\vc}: \share{\cdot}_{\Z_{2^k}}$.
  \item Return $(\overline{\share{\vc}(0)}, \dots, \overline{\share{\vc}(k-1)})$.
\end{enumerate}
\end{Boxfig}


\begin{Boxfig}{Rounding a $k$ bit integer by $m$ bits.}{fig:rounding}
  {$\mathsf{Round}_{[P_1, P_2, P_3]}(R; \share{\vx}^\mathsf{rep}_R, k, m)$}
  \begin{enumerate}
  \item Let $\left( (\vx_1^1, \vx_2^1), (\vx_2^2, \vx_3^2), (\vx_3^3, \vx_1^3) \right) = \share{\vx}^{\mathsf{rep}}_R$.

  \item On $P_3$:
  \begin{enumerate}
    \item $\shape \asn \mathsf{Shape}(\vx^3_3)$.
    \item $\prfkey \asn \mathsf{GenPrfKey}()$.
    \item $\seed_\ell \asn \mathsf{DeriveSeed}(\ell; \prfkey)$ for $\ell \in [k]$.
    \item $\mathbf{b}_\ell \asn \mathsf{SampleBits}(R; \shape, \seed_\ell)$ for $\ell \in [k]$.
    \item $\mathbf{r} \asn \sum_{\ell=0}^{k-1}2^\ell \cdot \vb_\ell$
    \item $\mathbf{r}_{\mathsf{msb}} \asn \vb_{k-1}$
    \item $\mathbf{r}_{\mathsf{top}} \asn \sum_{\ell=m}^{k-2} 2^{\ell-m} \cdot \vb_\ell$.
  \end{enumerate}

  \item $\share{\vr}^{\mathsf{add}} \asn \mathsf{AdditiveShare}_{[D=P_3, P_1, P_2]}(\vr)$

  \item $\share{\vr_{\mathsf{msb}}}^{\mathsf{add}} \asn \mathsf{AdditiveShare}_{[D=P_3, P_1, P_2]}(\vr_{\mathsf{msb}})$

  \item $\share{\vr_{\mathsf{top}}}^{\mathsf{add}} \asn \mathsf{AdditiveShare}_{[D=P_3, P_1, P_2]}(\vr_{\mathsf{top}})$

  \item $\share{\vx'}^{\mathsf{add}} \asn \mathsf{ReplicatedToAdditive}_{[P_1, P_2]}(\share{\vx}^{\mathsf{rep}})$.

  \item $\share{\vy'}^{\mathsf{add}} \asn \mathsf{2PCTruncPr}_{[P_1, P_2]}(\share{\vx'}^{\mathsf{add}}, m, \share{\vr}^{\mathsf{add}}, \share{\vr_{\mathsf{msb}}}^{\mathsf{add}}, \share{\vr_{\mathsf{top}}}^{\mathsf{add}} )$.

  \item Return $\share{\vy}^{\mathsf{rep}} \asn \mathsf{AdditiveToReplicated}_{[P_1, P_2, P_3]}(\share{\vy'}^{\mathsf{add}})$.
\end{enumerate}
\end{Boxfig}


